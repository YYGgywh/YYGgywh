# 六爻排盘API数据格式说明

## 1. 前端提交数据格式

### 1.1 排盘请求数据格式

**请求端点：** `POST /api/liuyao/paipan`

**请求体格式：**
```json
{
    "yao_list": ["123", "456", "789", "012", "345", "678"],
    "day_gan": "甲",
    "date_time": "2024-01-15 14:30:00"
}
```

**字段说明：**
- `yao_list` (必需): 6个三位数字符串组成的列表，代表6个爻位
- `day_gan` (必需): 日干信息，必须是十天干之一（甲、乙、丙、丁、戊、己、庚、辛、壬、癸）
- `date_time` (可选): 排盘时间，用于记录和验证

### 1.2 数据验证规则

**爻位数据验证：**
- 列表必须包含6个元素
- 每个元素必须是3位数字字符串
- 只能包含数字字符（0-9）

**日干验证：**
- 必须是有效的十天干
- 支持简繁体

### 1.3 示例数据

**有效示例：**
```json
{
    "yao_list": ["123", "456", "789", "012", "345", "678"],
    "day_gan": "甲"
}
```

**无效示例：**
```json
{
    "yao_list": ["123", "45", "789", "012", "345"],  // 只有5个爻位
    "day_gan": "甲"
}
```

```json
{
    "yao_list": ["123", "45a", "789", "012", "345", "678"],  // 包含非数字字符
    "day_gan": "甲"
}
```

## 2. 后端返回数据格式及中文键名对应

### 2.1 完整排盘结果格式

```json
{
    "yao_list": ["123", "456", "789", "012", "345", "678"],
    "odd_counts": [2, 1, 2, 1, 2, 1],
    "ben_gua": {
        "卦名": "地天泰",
        "卦宫": "坤宫",
        "宫属": "阳",
        "上卦": "坤",
        "下卦": "乾",
        "纳支": ["子", "寅", "辰", "午", "申", "戌"],
        "六亲": ["子孙", "妻财", "兄弟", "官鬼", "父母", "妻财"],
        "世应": ["应", "世"],
        "数列": [0, 1, 0, 1, 0, 1]
    },
    "dong_yao": {
        "positions": [2, 4],
        "symbols": ["", "×→", "", "○→", "", ""]
    },
    "bian_gua": {
        "卦名": "雷天大壮",
        "卦宫": "坤宫",
        "宫属": "阳",
        "上卦": "震",
        "下卦": "乾",
        "纳支": ["子", "寅", "辰", "午", "申", "戌"],
        "六亲": ["子孙", "妻财", "兄弟", "官鬼", "父母", "妻财"],
        "数列": [1, 0, 0, 0, 0, 1]
    },
    "liu_shen": ["青龙", "朱雀", "勾陈", "螣蛇", "白虎", "玄武"],
    "day_gan": "甲"
}
```

### 2.2 中文键名对应表

| 英文键名 | 中文含义 | 数据类型 | 说明 |
|---------|---------|---------|------|
| `yao_list` | 爻位列表 | List[str] | 6个三位数字符串 |
| `odd_counts` | 奇数个数 | List[int] | 每个爻位的奇数数量 |
| `ben_gua` | 本卦信息 | Dict | 本卦详细信息 |
| `bian_gua` | 变卦信息 | Dict | 变卦详细信息（无动爻时为空） |
| `dong_yao` | 动爻信息 | Dict | 动爻位置和符号 |
| `liu_shen` | 六神分布 | List[str] | 六神在爻位上的分布 |
| `day_gan` | 日干 | str | 排盘使用的日干 |

### 2.3 本卦/变卦内部字段对应

| 英文键名 | 中文含义 | 说明 |
|---------|---------|------|
| `卦名` | 卦名 | 卦象名称，如"乾为天" |
| `卦宫` | 卦宫 | 所属卦宫，如"乾宫" |
| `宫属` | 宫属 | 阴阳属性，如"阳" |
| `上卦` | 上卦 | 外卦名称 |
| `下卦` | 下卦 | 内卦名称 |
| `纳支` | 纳支 | 纳甲地支分布 |
| `六亲` | 六亲 | 六亲分布 |
| `世应` | 世应 | 世爻和应爻位置 |
| `数列` | 数列 | 二进制卦象序列 |

### 2.4 动爻信息字段对应

| 英文键名 | 中文含义 | 说明 |
|---------|---------|------|
| `positions` | 动爻位置 | 动爻的爻位编号（1-6） |
| `symbols` | 动爻符号 | 动爻的显示符号 |

### 2.5 六神对应关系

| 六神名称 | 英文显示 | 象征意义 |
|---------|---------|---------|
| 青龙 | 青龙 | 吉祥、生机 |
| 朱雀 | 朱雀 | 文书、口舌 |
| 勾陈 | 勾陈 | 田土、阻滞 |
| 螣蛇 | 螣蛇 | 虚惊、怪异 |
| 白虎 | 白虎 | 凶险、血光 |
| 玄武 | 玄武 | 盗贼、暧昧 |

## 3. 错误响应格式

### 3.1 数据验证错误
```json
{
    "error": "数据格式错误",
    "message": "爻位列表必须包含6个元素",
    "code": 400
}
```

### 3.2 日干验证错误
```json
{
    "error": "日干无效",
    "message": "日干必须是甲、乙、丙、丁、戊、己、庚、辛、壬、癸中的一个",
    "code": 400
}
```

## 4. 使用示例

### 4.1 前端调用示例（JavaScript）
```javascript
// 提交排盘请求
async function submitPaipan(yaoList, dayGan) {
    const response = await fetch('/api/liuyao/paipan', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            yao_list: yaoList,
            day_gan: dayGan
        })
    });
    
    if (response.ok) {
        const result = await response.json();
        console.log('排盘结果:', result);
        return result;
    } else {
        const error = await response.json();
        console.error('错误:', error.message);
        throw new Error(error.message);
    }
}
```

### 4.2 Python调用示例
```python
import requests

# 提交排盘请求
def submit_paipan(yao_list, day_gan):
    data = {
        "yao_list": yao_list,
        "day_gan": day_gan
    }
    
    response = requests.post("http://localhost:8000/api/liuyao/paipan", json=data)
    
    if response.status_code == 200:
        return response.json()
    else:
        error_data = response.json()
        raise Exception(f"排盘失败: {error_data['message']}")
```

## 5. 注意事项

1. **数据验证**：前端应确保提交的数据符合格式要求
2. **错误处理**：后端会返回详细的错误信息
3. **性能考虑**：排盘计算是CPU密集型操作，建议添加适当的缓存机制
4. **安全性**：确保API端点有适当的认证和限流措施

---

**文档版本：** v1.0  
**最后更新：** 2024年1月  
**维护者：** 六爻排盘项目组