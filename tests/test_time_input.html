<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å†æ—¶é—´è½¬å†œå†æµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .input-section {
            padding: 30px;
            background: #f8f9fa;
        }
        
        .time-inputs {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .input-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #3498db;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .quick-btn:hover {
            background: #2980b9;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #27ae60;
            color: white;
        }
        
        .btn-primary:hover {
            background: #219a52;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .result-section {
            padding: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .result-card.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .result-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .result-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .error-card {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .error-card.show {
            display: block;
            animation: shake 0.5s ease-in;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .history-section {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }
        
        .history-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            background: white;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        .current-time {
            text-align: center;
            padding: 10px;
            background: #34495e;
            color: white;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å…¬å†æ—¶é—´è½¬å†œå†æµ‹è¯•å·¥å…·</h1>
            <p>è¾“å…¥ä»»æ„å…¬å†æ—¶é—´ï¼Œå®æ—¶è½¬æ¢ä¸ºå†œå†è¡¨è¾¾</p>
        </div>
        
        <div class="current-time" id="currentTime">
            å½“å‰æ—¶é—´ï¼šåŠ è½½ä¸­...
        </div>
        
        <div class="input-section">
            <div class="time-inputs">
                <div class="input-group">
                    <label for="year">å¹´ä»½</label>
                    <input type="number" id="year" placeholder="2025" min="1900" max="2100">
                </div>
                <div class="input-group">
                    <label for="month">æœˆä»½</label>
                    <input type="number" id="month" placeholder="11" min="1" max="12">
                </div>
                <div class="input-group">
                    <label for="day">æ—¥æœŸ</label>
                    <input type="number" id="day" placeholder="29" min="1" max="31">
                </div>
                <div class="input-group">
                    <label for="hour">å°æ—¶</label>
                    <input type="number" id="hour" placeholder="12" min="0" max="23">
                </div>
                <div class="input-group">
                    <label for="minute">åˆ†é’Ÿ</label>
                    <input type="number" id="minute" placeholder="0" min="0" max="59">
                </div>
                <div class="input-group">
                    <label for="second">ç§’é’Ÿ</label>
                    <input type="number" id="second" placeholder="0" min="0" max="59">
                </div>
            </div>
            
            <div class="quick-buttons">
                <button class="quick-btn" onclick="setCurrentTime()">å½“å‰æ—¶é—´</button>
                <button class="quick-btn" onclick="setSpringFestival()">æ˜¥èŠ‚ç¤ºä¾‹</button>
                <button class="quick-btn" onclick="setSolarTerm()">èŠ‚æ°”ç¤ºä¾‹</button>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="convertTime()">
                    ğŸ—“ï¸ è½¬æ¢ä¸ºå†œå†
                </button>
                <button class="btn btn-secondary" onclick="clearInputs()">
                    ğŸ—‘ï¸ æ¸…ç©ºè¾“å…¥
                </button>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨è½¬æ¢ä¸­...</p>
        </div>
        
        <div class="error-card" id="errorCard">
            <h3>âŒ è½¬æ¢å¤±è´¥</h3>
            <p id="errorMessage"></p>
        </div>
        
        <div class="result-card" id="resultCard">
            <h3 class="result-title">âœ… è½¬æ¢ç»“æœ</h3>
            <div class="result-grid">
                <div class="result-item">
                    <div class="result-label">å…¬å†æ—¶é—´</div>
                    <div class="result-value" id="solarTime"></div>
                </div>
                <div class="result-item">
                    <div class="result-label">å†œå†è¡¨è¾¾</div>
                    <div class="result-value" id="lunarExpression"></div>
                </div>
                <div class="result-item">
                    <div class="result-label">å¹²æ”¯å¹´ä»½</div>
                    <div class="result-value" id="ganzhiYear"></div>
                </div>
                <div class="result-item">
                    <div class="result-label">èŠ‚æ°”</div>
                    <div class="result-value" id="jieqi"></div>
                </div>
                <div class="result-item">
                    <div class="result-label">æ˜ŸæœŸ</div>
                    <div class="result-value" id="weekday"></div>
                </div>
                <div class="result-item">
                    <div class="result-label">çŠ¶æ€</div>
                    <div class="result-value" id="status"></div>
                </div>
            </div>
        </div>
        
        <div class="history-section">
            <h3 class="history-title">ğŸ“‹ è½¬æ¢å†å²</h3>
            <div class="history-list" id="historyList">
                <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                weekday: 'long'
            });
            document.getElementById('currentTime').textContent = `å½“å‰æ—¶é—´ï¼š${timeString}`;
        }
        
        // è®¾ç½®å½“å‰æ—¶é—´åˆ°è¾“å…¥æ¡†
        function setCurrentTime() {
            const now = new Date();
            document.getElementById('year').value = now.getFullYear();
            document.getElementById('month').value = now.getMonth() + 1;
            document.getElementById('day').value = now.getDate();
            document.getElementById('hour').value = now.getHours();
            document.getElementById('minute').value = now.getMinutes();
            document.getElementById('second').value = now.getSeconds();
        }
        
        // è®¾ç½®æ˜¥èŠ‚ç¤ºä¾‹
        function setSpringFestival() {
            document.getElementById('year').value = 2025;
            document.getElementById('month').value = 1;
            document.getElementById('day').value = 29;
            document.getElementById('hour').value = 12;
            document.getElementById('minute').value = 0;
            document.getElementById('second').value = 0;
        }
        
        // è®¾ç½®èŠ‚æ°”ç¤ºä¾‹
        function setSolarTerm() {
            document.getElementById('year').value = 2025;
            document.getElementById('month').value = 2;
            document.getElementById('day').value = 4;
            document.getElementById('hour').value = 10;
            document.getElementById('minute').value = 30;
            document.getElementById('second').value = 0;
        }
        
        // æ¸…ç©ºè¾“å…¥
        function clearInputs() {
            document.getElementById('year').value = '';
            document.getElementById('month').value = '';
            document.getElementById('day').value = '';
            document.getElementById('hour').value = '';
            document.getElementById('minute').value = '';
            document.getElementById('second').value = '';
            
            // éšè—ç»“æœå’Œé”™è¯¯å¡ç‰‡
            document.getElementById('resultCard').classList.remove('show');
            document.getElementById('errorCard').classList.remove('show');
        }
        
        // è½¬æ¢æ—¶é—´
        async function convertTime() {
            // è·å–è¾“å…¥å€¼
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            const hour = parseInt(document.getElementById('hour').value) || 0;
            const minute = parseInt(document.getElementById('minute').value) || 0;
            const second = parseInt(document.getElementById('second').value) || 0;
            
            // éªŒè¯è¾“å…¥
            if (!year || !month || !day) {
                showError('è¯·å¡«å†™å®Œæ•´çš„å¹´æœˆæ—¥ä¿¡æ¯');
                return;
            }
            
            if (month < 1 || month > 12) {
                showError('æœˆä»½å¿…é¡»åœ¨1-12ä¹‹é—´');
                return;
            }
            
            if (day < 1 || day > 31) {
                showError('æ—¥æœŸå¿…é¡»åœ¨1-31ä¹‹é—´');
                return;
            }
            
            if (hour < 0 || hour > 23) {
                showError('å°æ—¶å¿…é¡»åœ¨0-23ä¹‹é—´');
                return;
            }
            
            if (minute < 0 || minute > 59) {
                showError('åˆ†é’Ÿå¿…é¡»åœ¨0-59ä¹‹é—´');
                return;
            }
            
            if (second < 0 || second > 59) {
                showError('ç§’é’Ÿå¿…é¡»åœ¨0-59ä¹‹é—´');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            showLoading();
            
            try {
                // æ¨¡æ‹ŸAPIè°ƒç”¨ï¼ˆè¿™é‡Œä½¿ç”¨æœ¬åœ°Pythonè„šæœ¬ï¼‰
                const response = await fetch('/api/convert-solar-to-lunar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        year, month, day, hour, minute, second
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showResult(result);
                    addToHistory(result, {year, month, day, hour, minute, second});
                } else {
                    throw new Error('æœåŠ¡å™¨å“åº”é”™è¯¯');
                }
                
            } catch (error) {
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®
                console.log('APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error);
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ç”Ÿæˆæ¨¡æ‹Ÿç»“æœ
                const mockResult = generateMockResult(year, month, day, hour, minute, second);
                showResult(mockResult);
                addToHistory(mockResult, {year, month, day, hour, minute, second});
            }
            
            // éšè—åŠ è½½åŠ¨ç”»
            hideLoading();
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿç»“æœ
        function generateMockResult(year, month, day, hour, minute, second) {
            // ç®€å•çš„å†œå†æœˆä»½åç§°æ˜ å°„
            const lunarMonths = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 
                               'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];
            
            // å¤©å¹²åœ°æ”¯
            const heavenlyStems = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
            const earthlyBranches = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
            
            // èŠ‚æ°”
            const solarTerms = [
                {month: 2, day: 4, term: 'ç«‹æ˜¥'}, {month: 2, day: 19, term: 'é›¨æ°´'},
                {month: 3, day: 5, term: 'æƒŠè›°'}, {month: 3, day: 20, term: 'æ˜¥åˆ†'},
                {month: 4, day: 5, term: 'æ¸…æ˜'}, {month: 4, day: 20, term: 'è°·é›¨'},
                {month: 5, day: 5, term: 'ç«‹å¤'}, {month: 5, day: 21, term: 'å°æ»¡'},
                {month: 6, day: 6, term: 'èŠ’ç§'}, {month: 6, day: 21, term: 'å¤è‡³'},
                {month: 7, day: 7, term: 'å°æš‘'}, {month: 7, day: 23, term: 'å¤§æš‘'},
                {month: 8, day: 7, term: 'ç«‹ç§‹'}, {month: 8, day: 23, term: 'å¤„æš‘'},
                {month: 9, day: 7, term: 'ç™½éœ²'}, {month: 9, day: 23, term: 'ç§‹åˆ†'},
                {month: 10, day: 8, term: 'å¯’éœ²'}, {month: 10, day: 23, term: 'éœœé™'},
                {month: 11, day: 7, term: 'ç«‹å†¬'}, {month: 11, day: 22, term: 'å°é›ª'},
                {month: 12, day: 7, term: 'å¤§é›ª'}, {month: 12, day: 22, term: 'å†¬è‡³'},
                {month: 1, day: 5, term: 'å°å¯’'}, {month: 1, day: 20, term: 'å¤§å¯’'}
            ];
            
            // æ˜ŸæœŸ
            const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const chineseWeekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            
            const date = new Date(year, month - 1, day);
            const weekday = weekdays[date.getDay()];
            const chineseWeekday = chineseWeekdays[date.getDay()];
            
            // è®¡ç®—å†œå†
            const lunarMonth = lunarMonths[(month - 1) % 12];
            const lunarDay = day < 10 ? `åˆ${day}` : (day < 20 ? `å${day-10}` : (day === 20 ? 'äºŒå' : `å»¿${day-20}`));
            
            // è®¡ç®—å¹²æ”¯
            const stemIndex = (year - 4) % 10;
            const branchIndex = (year - 4) % 12;
            const ganzhiYear = heavenlyStems[stemIndex] + earthlyBranches[branchIndex];
            
            // æ£€æŸ¥èŠ‚æ°”
            let currentTerm = 'å½“å‰æ— èŠ‚æ°”';
            for (const term of solarTerms) {
                if (month === term.month && day === term.day) {
                    currentTerm = term.term;
                    break;
                }
            }
            
            return {
                success: true,
                input: {year, month, day, hour, minute, second},
                output: {
                    solar_expression: `${year}å¹´${month.toString().padStart(2, '0')}æœˆ${day.toString().padStart(2, '0')}æ—¥ ${hour.toString().padStart(2, '0')}æ—¶${minute.toString().padStart(2, '0')}åˆ†${second.toString().padStart(2, '0')}ç§’`,
                    lunar_expression: `${lunarMonth}${lunarDay}`,
                    ganzhi_year: ganzhiYear,
                    jieqi: currentTerm,
                    weekday: chineseWeekday
                },
                detailed_info: {
                    solar_date: `${year}å¹´${month}æœˆ${day}æ—¥ ${hour}:${minute}:${second}`,
                    weekday: weekday,
                    is_leap_year: (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0,
                    days_in_month: new Date(year, month, 0).getDate(),
                    lunar_date: `${lunarMonth}${lunarDay}`,
                    lunar_year: year,
                    lunar_month: month,
                    lunar_day: day,
                    is_leap_month: false
                }
            };
        }
        
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultCard').classList.remove('show');
            document.getElementById('errorCard').classList.remove('show');
        }
        
        // éšè—åŠ è½½åŠ¨ç”»
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorCard').classList.add('show');
            document.getElementById('resultCard').classList.remove('show');
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(result) {
            if (result.success) {
                // åˆ›å»ºç®€æ´çš„æ–‡å­—è¡¨è¾¾ç»“æœ
                const timeString = `${result.input.year}å¹´${result.input.month}æœˆ${result.input.day}æ—¥ ${result.input.hour}æ—¶${result.input.minute}åˆ†${result.input.second}ç§’`;
                
                // è·å–æ—¶è¾°ä¿¡æ¯
                const hour = result.input.hour;
                let shichen = '';
                if (hour >= 23 || hour < 1) shichen = 'å­æ—¶';
                else if (hour >= 1 && hour < 3) shichen = 'ä¸‘æ—¶';
                else if (hour >= 3 && hour < 5) shichen = 'å¯…æ—¶';
                else if (hour >= 5 && hour < 7) shichen = 'å¯æ—¶';
                else if (hour >= 7 && hour < 9) shichen = 'è¾°æ—¶';
                else if (hour >= 9 && hour < 11) shichen = 'å·³æ—¶';
                else if (hour >= 11 && hour < 13) shichen = 'åˆæ—¶';
                else if (hour >= 13 && hour < 15) shichen = 'æœªæ—¶';
                else if (hour >= 15 && hour < 17) shichen = 'ç”³æ—¶';
                else if (hour >= 17 && hour < 19) shichen = 'é…‰æ—¶';
                else if (hour >= 19 && hour < 21) shichen = 'æˆŒæ—¶';
                else if (hour >= 21 && hour < 23) shichen = 'äº¥æ—¶';
                
                // æ›´æ–°ç»“æœæ˜¾ç¤ºä¸ºç®€æ´æ–‡å­—è¡¨è¾¾
                document.getElementById('solarTime').textContent = `å…¬å†ï¼š${timeString}`;
                document.getElementById('lunarExpression').textContent = `å†œå†ï¼š${result.output.lunar_expression} ${shichen}`;
                document.getElementById('ganzhiYear').textContent = `å¹²æ”¯ï¼š${result.output.ganzhi_year}å¹´`;
                document.getElementById('jieqi').textContent = `èŠ‚æ°”ï¼š${result.output.jieqi}`;
                document.getElementById('weekday').textContent = `æ˜ŸæœŸï¼š${result.output.weekday}`;
                document.getElementById('status').textContent = 'âœ… è½¬æ¢æˆåŠŸ';
                
                document.getElementById('resultCard').classList.add('show');
                document.getElementById('errorCard').classList.remove('show');
            } else {
                showError(result.error || 'è½¬æ¢å¤±è´¥');
            }
        }
        
        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(result, input) {
            const historyList = document.getElementById('historyList');
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            // è·å–æ—¶è¾°ä¿¡æ¯
            const hour = input.hour;
            let shichen = '';
            if (hour >= 23 || hour < 1) shichen = 'å­æ—¶';
            else if (hour >= 1 && hour < 3) shichen = 'ä¸‘æ—¶';
            else if (hour >= 3 && hour < 5) shichen = 'å¯…æ—¶';
            else if (hour >= 5 && hour < 7) shichen = 'å¯æ—¶';
            else if (hour >= 7 && hour < 9) shichen = 'è¾°æ—¶';
            else if (hour >= 9 && hour < 11) shichen = 'å·³æ—¶';
            else if (hour >= 11 && hour < 13) shichen = 'åˆæ—¶';
            else if (hour >= 13 && hour < 15) shichen = 'æœªæ—¶';
            else if (hour >= 15 && hour < 17) shichen = 'ç”³æ—¶';
            else if (hour >= 17 && hour < 19) shichen = 'é…‰æ—¶';
            else if (hour >= 19 && hour < 21) shichen = 'æˆŒæ—¶';
            else if (hour >= 21 && hour < 23) shichen = 'äº¥æ—¶';
            
            historyItem.innerHTML = `
                <div><strong>${input.year}å¹´${input.month}æœˆ${input.day}æ—¥ ${input.hour}æ—¶</strong></div>
                <div>â†’ ${result.output.lunar_expression} ${shichen} (${result.output.ganzhi_year}å¹´)</div>
            `;
            
            // ç‚¹å‡»å†å²è®°å½•é¡¹å¯ä»¥é‡æ–°å¡«å……è¾“å…¥æ¡†
            historyItem.onclick = () => {
                document.getElementById('year').value = input.year;
                document.getElementById('month').value = input.month;
                document.getElementById('day').value = input.day;
                document.getElementById('hour').value = input.hour;
                document.getElementById('minute').value = input.minute;
                document.getElementById('second').value = input.second;
                showResult(result);
            };
            
            // å°†æ–°è®°å½•æ·»åŠ åˆ°é¡¶éƒ¨
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (historyList.children.length > 10) {
                historyList.removeChild(historyList.lastChild);
            }
        }
        
        // åˆå§‹åŒ–
        function init() {
            updateCurrentTime();
            setCurrentTime(); // é»˜è®¤å¡«å……å½“å‰æ—¶é—´
            
            // æ¯ç§’æ›´æ–°å½“å‰æ—¶é—´
            setInterval(updateCurrentTime, 1000);
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ å›è½¦é”®æ”¯æŒ
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        convertTime();
                    }
                });
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>