/*
 * @file            frontend/src/contexts/DivinationContext.jsx
 * @description     占卜信息上下文，用于共享表单数据、时间数据和起卦数据
 * @author          Gordon <gordon_cao@qq.com>
 * @createTime      2026-02-10 10:00:00
 * @lastModified    2026-02-19 14:26:20
 * Copyright © All rights reserved
*/

import React, { createContext, useState, useContext } from 'react';  // 导入 React 核心库和 Hooks

/**
 * @description     创建占卜上下文
 */

const DivinationContext = createContext();  // 创建 Context 对象

/**
 * @description     自定义 Hook，方便组件使用 Context
 * @return          {Object}                     Context 上下文对象
 */

// 定义 useDivination 自定义 Hook
export const useDivination = () => {
  const context = useContext(DivinationContext);  // 获取 Context 上下文
  // 检查 Context 是否存在
  if (!context) {
    throw new Error('useDivination must be used within a DivinationProvider');  // 抛出错误
  }
  return context;  // 返回 Context 上下文
};

/**
 * @description     Context Provider 组件
 * @param           {JSX}       children          子组件
 * @return          {JSX}                          Provider 组件
 */

// 定义 DivinationProvider 组件
export const DivinationProvider = ({ children }) => {
  // 表单数据状态
  const [formData, setFormData] = useState({
    firstName: '',    // 名字
    lastName: '',     // 姓氏
    gender: '男',     // 性别
    birthYear: '',    // 出生年份
    location: '',     // 地点
    divinationType: '',  // 排盘方式
    subType: '',      // 子类型
    question: ''      // 占卜问题
  });
  
  const [timestamp, setTimestamp] = useState(null);  // 时间戳状态
  
  const [threeDigitsArray, setThreeDigitsArray] = useState([]);  // 起卦三位数数组状态

  // 后端返回数据
  const [calendarResult, setCalendarResult] = useState(null);  // 日历结果状态
  const [divineResult, setDivineResult] = useState(null);  // 占卜结果状态

  // 渲染 DivinationContext.Provider，向子组件提供全局状态与更新函数
  return (
    // Context Provider 组件
    <DivinationContext.Provider
      value={{  // Provider 的值对象
        formData,  // 表单数据
        setFormData,  // 设置表单数据方法
        timestamp,  // 时间戳
        setTimestamp,  // 设置时间戳方法
        threeDigitsArray,  // 三位数数组
        setThreeDigitsArray,  // 设置三位数数组方法
        calendarResult,  // 日历结果
        setCalendarResult,  // 设置日历结果方法
        divineResult,  // 占卜结果
        setDivineResult  // 设置占卜结果方法
      }}
    >
      {children}  {/* 子组件 */}
    </DivinationContext.Provider>
  );
};
