// 路径:src/components/LiuYao/methods/SpecifiedMethod.jsx 时间:2026-02-09 17:00
// 功能:指定起卦组件，手动输入爻值生成卦象
import React, { useState } from 'react';
import '../LiuYaoQiGua/LiuYaoQiGua.css';
import styles from './SpecifiedMethod.module.css';

const SpecifiedMethod = ({ onReset }) => {
  const [yaoValues, setYaoValues] = useState({
    shang: '',
    wu: '',
    si: '',
    san: '',
    er: '',
    chu: ''
  });

  // 跟踪每个爻位的阳阴选择状态：'yang' | 'yin' | null (未选中)
  const [yaoSelections, setYaoSelections] = useState({
    shang: null,
    wu: null,
    si: null,
    san: null,
    er: null,
    chu: null
  });

  // 跟踪每个爻位的动爻选择状态：boolean
  const [dongYaoSelections, setDongYaoSelections] = useState({
    shang: false,
    wu: false,
    si: false,
    san: false,
    er: false,
    chu: false
  });

  const [hasValidInput, setHasValidInput] = useState(false); // 跟踪是否有合法输入

  const handleYaoChange = (position, value) => {
    setYaoValues(prev => {
      const newValues = {
        ...prev,
        [position]: value
      };
      
      // 检查是否有任何输入框有值
      const hasAnyInput = Object.values(newValues).some(val => val.length > 0);
      setHasValidInput(hasAnyInput);
      
      return newValues;
    });
  };

  const handleSpecifiedDivination = () => {
    // 指定起卦逻辑
    console.log('执行指定起卦', yaoValues);
  };

  // 处理阳阴按钮点击
  const handleYaoButtonClick = (position, type) => {
    setYaoSelections(prev => ({
      ...prev,
      [position]: prev[position] === type ? null : type // 再次点击同一按钮取消选择
    }));
    
    // 同时更新yaoValues，以便与其他起卦方式保持一致的数据结构
    setYaoValues(prev => ({
      ...prev,
      [position]: type === 'yang' ? '阳' : '阴'
    }));
  };

  // 处理动爻按钮点击
  const handleDongYaoButtonClick = (position) => {
    setDongYaoSelections(prev => ({
      ...prev,
      [position]: !prev[position] // 切换选中状态
    }));
  };

  const handleReset = () => {
    // 清空所有输入框
    setYaoValues({
      shang: '',
      wu: '',
      si: '',
      san: '',
      er: '',
      chu: ''
    });
    
    // 重置阳阴选择状态
    setYaoSelections({
      shang: null,
      wu: null,
      si: null,
      san: null,
      er: null,
      chu: null
    });
    
    // 重置动爻选择状态
    setDongYaoSelections({
      shang: false,
      wu: false,
      si: false,
      san: false,
      er: false,
      chu: false
    });
    
    // 重置输入状态
    setHasValidInput(false);
    
    // 调用父组件的重置函数
    if (onReset) {
      onReset();
    }
  };

  return (
    <div className="step-by-step-method">
      <div className="content-row">
        <div className="liu-yao-info">
          <h3>指定起卦：</h3>
          <p>手动指定六爻值，适合有经验的使用者。</p>
          <ol>
            <li>根据已知信息，填写各爻值</li>
            <li>点击起卦，系统根据指定值生成卦象</li>
          </ol>
          <div className="divination-actions">
            <button 
              className="throw-button" 
              onClick={handleSpecifiedDivination}
            >
              指定起卦
            </button>
            <button 
              className="reset-button" 
              onClick={handleReset}
              disabled={!hasValidInput}
            >
              重新输入
            </button>
          </div>
        </div>

        <div className="yao-display">
          <div className="yao-item">
            <span className="yao-label">上爻：</span>
            <div className={styles.yaoButtonsContainer}>
              <button
                className={`${styles.yaoButton} ${styles.yangButton} ${yaoSelections.shang === 'yang' ? styles.yangButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('shang', 'yang')}
              >
                阳
              </button>
              <button
                className={`${styles.yaoButton} ${styles.yinButton} ${yaoSelections.shang === 'yin' ? styles.yinButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('shang', 'yin')}
              >
                阴
              </button>
            </div>
            <input
              type="text"
              className={`yao-value ${yaoValues.shang === '' ? 'yao-value-placeholder' : ''}`}
              placeholder="待输入"
              value={yaoValues.shang}
              onChange={(e) => handleYaoChange('shang', e.target.value)}
              style={{
                width: '68px',
                height: '29px',
                boxSizing: 'border-box',
                outline: 'none'
              }}
            />
            <button
              className={`${styles.dongYaoButton} ${dongYaoSelections.shang ? styles.dongYaoButtonSelected : ''} ${dongYaoSelections.shang && yaoSelections.shang === 'yang' ? styles.dongYaoButtonSelectedYang : ''} ${dongYaoSelections.shang && yaoSelections.shang === 'yin' ? styles.dongYaoButtonSelectedYin : ''}`}
              onClick={() => handleDongYaoButtonClick('shang')}
              disabled={!yaoSelections.shang}
            >
              动
            </button>
            <div className="yao-component"></div>
          </div>
          <div className="yao-item">
            <span className="yao-label">五爻：</span>
            <div className={styles.yaoButtonsContainer}>
              <button
                className={`${styles.yaoButton} ${styles.yangButton} ${yaoSelections.wu === 'yang' ? styles.yangButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('wu', 'yang')}
              >
                阳
              </button>
              <button
                className={`${styles.yaoButton} ${styles.yinButton} ${yaoSelections.wu === 'yin' ? styles.yinButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('wu', 'yin')}
              >
                阴
              </button>
            </div>
            <input
              type="text"
              className={`yao-value ${yaoValues.wu === '' ? 'yao-value-placeholder' : ''}`}
              placeholder="待输入"
              value={yaoValues.wu}
              onChange={(e) => handleYaoChange('wu', e.target.value)}
              style={{
                width: '68px',
                height: '29px',
                boxSizing: 'border-box',
                outline: 'none'
              }}
            />
            <button
              className={`${styles.dongYaoButton} ${dongYaoSelections.wu ? styles.dongYaoButtonSelected : ''} ${dongYaoSelections.wu && yaoSelections.wu === 'yang' ? styles.dongYaoButtonSelectedYang : ''} ${dongYaoSelections.wu && yaoSelections.wu === 'yin' ? styles.dongYaoButtonSelectedYin : ''}`}
              onClick={() => handleDongYaoButtonClick('wu')}
              disabled={!yaoSelections.wu}
            >
              动
            </button>
            <div className="yao-component"></div>
          </div>
          <div className="yao-item">
            <span className="yao-label">四爻：</span>
            <div className={styles.yaoButtonsContainer}>
              <button
                className={`${styles.yaoButton} ${styles.yangButton} ${yaoSelections.si === 'yang' ? styles.yangButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('si', 'yang')}
              >
                阳
              </button>
              <button
                className={`${styles.yaoButton} ${styles.yinButton} ${yaoSelections.si === 'yin' ? styles.yinButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('si', 'yin')}
              >
                阴
              </button>
            </div>
            <input
              type="text"
              className={`yao-value ${yaoValues.si === '' ? 'yao-value-placeholder' : ''}`}
              placeholder="待输入"
              value={yaoValues.si}
              onChange={(e) => handleYaoChange('si', e.target.value)}
              style={{
                width: '68px',
                height: '29px',
                boxSizing: 'border-box',
                outline: 'none'
              }}
            />
            <button
              className={`${styles.dongYaoButton} ${dongYaoSelections.si ? styles.dongYaoButtonSelected : ''} ${dongYaoSelections.si && yaoSelections.si === 'yang' ? styles.dongYaoButtonSelectedYang : ''} ${dongYaoSelections.si && yaoSelections.si === 'yin' ? styles.dongYaoButtonSelectedYin : ''}`}
              onClick={() => handleDongYaoButtonClick('si')}
              disabled={!yaoSelections.si}
            >
              动
            </button>
            <div className="yao-component"></div>
          </div>
          <div className="yao-item">
            <span className="yao-label">三爻：</span>
            <div className={styles.yaoButtonsContainer}>
              <button
                className={`${styles.yaoButton} ${styles.yangButton} ${yaoSelections.san === 'yang' ? styles.yangButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('san', 'yang')}
              >
                阳
              </button>
              <button
                className={`${styles.yaoButton} ${styles.yinButton} ${yaoSelections.san === 'yin' ? styles.yinButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('san', 'yin')}
              >
                阴
              </button>
            </div>
            <input
              type="text"
              className={`yao-value ${yaoValues.san === '' ? 'yao-value-placeholder' : ''}`}
              placeholder="待输入"
              value={yaoValues.san}
              onChange={(e) => handleYaoChange('san', e.target.value)}
              style={{
                width: '68px',
                height: '29px',
                boxSizing: 'border-box',
                outline: 'none'
              }}
            />
            <button
              className={`${styles.dongYaoButton} ${dongYaoSelections.san ? styles.dongYaoButtonSelected : ''} ${dongYaoSelections.san && yaoSelections.san === 'yang' ? styles.dongYaoButtonSelectedYang : ''} ${dongYaoSelections.san && yaoSelections.san === 'yin' ? styles.dongYaoButtonSelectedYin : ''}`}
              onClick={() => handleDongYaoButtonClick('san')}
              disabled={!yaoSelections.san}
            >
              动
            </button>
            <div className="yao-component"></div>
          </div>
          <div className="yao-item">
            <span className="yao-label">二爻：</span>
            <div className={styles.yaoButtonsContainer}>
              <button
                className={`${styles.yaoButton} ${styles.yangButton} ${yaoSelections.er === 'yang' ? styles.yangButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('er', 'yang')}
              >
                阳
              </button>
              <button
                className={`${styles.yaoButton} ${styles.yinButton} ${yaoSelections.er === 'yin' ? styles.yinButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('er', 'yin')}
              >
                阴
              </button>
            </div>
            <input
              type="text"
              className={`yao-value ${yaoValues.er === '' ? 'yao-value-placeholder' : ''}`}
              placeholder="待输入"
              value={yaoValues.er}
              onChange={(e) => handleYaoChange('er', e.target.value)}
              style={{
                width: '68px',
                height: '29px',
                boxSizing: 'border-box',
                outline: 'none'
              }}
            />
            <button
              className={`${styles.dongYaoButton} ${dongYaoSelections.er ? styles.dongYaoButtonSelected : ''} ${dongYaoSelections.er && yaoSelections.er === 'yang' ? styles.dongYaoButtonSelectedYang : ''} ${dongYaoSelections.er && yaoSelections.er === 'yin' ? styles.dongYaoButtonSelectedYin : ''}`}
              onClick={() => handleDongYaoButtonClick('er')}
              disabled={!yaoSelections.er}
            >
              动
            </button>
            <div className="yao-component"></div>
          </div>
          <div className="yao-item">
            <span className="yao-label">初爻：</span>
            <div className={styles.yaoButtonsContainer}>
              <button
                className={`${styles.yaoButton} ${styles.yangButton} ${yaoSelections.chu === 'yang' ? styles.yangButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('chu', 'yang')}
              >
                阳
              </button>
              <button
                className={`${styles.yaoButton} ${styles.yinButton} ${yaoSelections.chu === 'yin' ? styles.yinButtonSelected : ''}`}
                onClick={() => handleYaoButtonClick('chu', 'yin')}
              >
                阴
              </button>
            </div>
            <input
              type="text"
              className={`yao-value ${yaoValues.chu === '' ? 'yao-value-placeholder' : ''}`}
              placeholder="待输入"
              value={yaoValues.chu}
              onChange={(e) => handleYaoChange('chu', e.target.value)}
              style={{
                width: '68px',
                height: '29px',
                boxSizing: 'border-box',
                outline: 'none'
              }}
            />
            <button
              className={`${styles.dongYaoButton} ${dongYaoSelections.chu ? styles.dongYaoButtonSelected : ''} ${dongYaoSelections.chu && yaoSelections.chu === 'yang' ? styles.dongYaoButtonSelectedYang : ''} ${dongYaoSelections.chu && yaoSelections.chu === 'yin' ? styles.dongYaoButtonSelectedYin : ''}`}
              onClick={() => handleDongYaoButtonClick('chu')}
              disabled={!yaoSelections.chu}
            >
              动
            </button>
            <div className="yao-component"></div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SpecifiedMethod;